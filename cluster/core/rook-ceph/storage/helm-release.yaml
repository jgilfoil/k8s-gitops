---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: rook-ceph-cluster
  namespace: rook-ceph
spec:
  interval: 5m
  chart:
    spec:
      # renovate: registryUrl=https://charts.rook.io/release
      chart: rook-ceph-cluster
      version: v1.7.7
      sourceRef:
        kind: HelmRepository
        name: rook-ceph-charts
        namespace: flux-system
  values:
    placement:
      all:
        tolerations:
          - operator: "Exists"
    crashCollector:
      disable: false
      daysToRetain: 30
    dashboard:
      enabled: true
      port: 7000
      ssl: false
    resources:
      mon:
        requests:
          cpu: 35m
          memory: 800Mi
        limits:
          memory: 1024Mi
      osd:
        requests:
          cpu: 35m
          memory: 2048Mi
        limits:
          memory: 4096Mi
    storage:
      useAllNodes: false
      useAllDevices: false
      config:
        osdsPerDevice: "1"
      nodes:
        - name: "odroid-01"
          devices:
            - name: "sda"
        - name: "odroid-02"
          devices:
            - name: "sda"
        - name: "odroid-03"
          devices:
            - name: "sda"
    ingress:
      dashboard:
        annotations:
          cert-manager.io/cluster-issuer: "letsencrypt-production"
          traefik.ingress.kubernetes.io/router.entrypoints: "websecure"
        host:
          name: "rook.${SECRET_DOMAIN}"
          path: /
        # tls:
        #   - hosts:
        #     - "rook.${SECRET_DOMAIN}"
        #     secret_name: "rook-dashboard-tls"
